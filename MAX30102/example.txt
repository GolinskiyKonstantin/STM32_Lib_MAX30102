/*	сохраняем данный файл в кодировке UTF-8		*/

/*

	Настройка I2C скорость 400 000 
	пин прерывания называем INT или в коде меняем на другое имя
	прерывание ставим Falling и сам пин подтягиваем к Pull-up
	и незвбываем установить галочку прерывания NVIC

*/

/*
	ВНИМАНИЕ!!! часто в модулях Max30102 и Max30105 перепутаны каналы светодиодов ir_led  и red_led поэтому если показания данных не корректное
	то тогда в функции Max30102_ReadFifo в файле MAX30102.c и MAX30102.h меняем местами входящие параметры. 
	Ниже приведен пример:

	MAX30102_STATUS Max30102_ReadFifo(volatile uint32_t *pun_red_led, volatile uint32_t *pun_ir_led){}	// вариант 1
	MAX30102_STATUS Max30102_ReadFifo(volatile uint32_t *pun_ir_led, volatile uint32_t *pun_red_led){}	// вариант 2
*/

	#include "stdio.h"
	#include "string.h"
	#include "MAX30102.h"
	
	
	
	.........
	.........

main()=============================================================================================================================

	Max30102_Init(&hi2c1);

	// переходим в спящий режим
	Max30102_ShutdownMode(1);
	HAL_Delay(1000);

	// выходим из спящего режима
	Max30102_ShutdownMode(0);
	HAL_Delay(1000);
		
	static int32_t hr_old = 1, spo2_old = 1;
		
	
	.........
	.........
	.........

while(1)===========================================================================================================================

	
	///////////////////////////////////////////////////////////////////////////////
	  
	 Max30102_Task();
	  
	char Buffer[32]; 
	  
	  
	 if (( Max30102_IsFingerOnSensor() == MAX30102_OK) && ((hr_old != Max30102_GetHeartRate()) || (spo2_old != Max30102_GetSpO2Value())) ){
	 
		// Max30102_GetHeartRate(); - текущие значения частоты сердечных сокращений
		hr_old = Max30102_GetHeartRate();
		
		// Max30102_GetSpO2Value(); - Насыщенность крови кислородом от 0 до 100 ( 100 -круто )
		spo2_old = Max30102_GetSpO2Value();
		
		 //-------------------------------------------------------------
		sprintf(Buffer, "%c[2J%c[H", 27, 27);	// отчистка окна терминала
		printf("%s \r\n", Buffer);
		 //-------------------------------------------------------------
		 
		sprintf(Buffer, "  HR: %3d bpm\r\nSpO2: %3d %%\r\n", hr_old, spo2_old);
		printf("%s",Buffer);
		 
		float T = Max30102_ReadTemperature();
		printf("Temp: %0.2f\r\n",  T );
		 
    }
	 
	///////////////////////////////////////////////////////////////////////////////////////////////
	
	
	.........
	.........
	.........
	.........

=== end while(1) ==================================================================================================================
=== end main() ====================================================================================================================

/////////  обработчик прерывания  ///////////////////////////////////////////////////////////////////

void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin) {
	if (GPIO_Pin == INT_Pin) {
		Max30102_InterruptCallback();
	}
}

////////////////////////////////////////////////////////////////////////////////////////////////////

